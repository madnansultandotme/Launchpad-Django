{% extends "sidebar.html" %}
{% load static %}
{% block title %}All Pages - Launchpad{% endblock %}

{% block dashboard_content %}
<div class="space-y-6">
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
    <h1 class="text-2xl font-semibold text-blue-400">All Pages</h1>
    
    <form method="get" class="mt-4 sm:mt-0 flex items-center">
      <input
        type="text"
        name="q"
        placeholder="Search pages..."
        value="{{ query }}"
        class="rounded-md border border-slate-700 bg-slate-900/70 px-4 py-2 text-sm text-slate-100 placeholder-slate-500 focus:border-blue-400 focus:outline-none"
      />
      <button type="submit" class="ml-2 rounded-md bg-blue-500 px-4 py-2 text-sm font-semibold text-slate-950 hover:bg-blue-400 transition">
        Search
      </button>
    </form>
  </div>

  <div class="overflow-x-auto rounded-xl border border-slate-800 bg-slate-900/50 shadow-lg shadow-slate-950/30">
    <table class="min-w-full divide-y divide-slate-800">
      <thead class="bg-slate-900/80 text-left text-slate-300 text-xs uppercase tracking-widest">
        <tr>
          <th class="px-3 py-3">Title</th>
          <th class="px-3 py-3">Content</th>
          <th class="px-3 py-3">Created At</th>
          <th class="px-2.5 py-3">Published</th>
          <th class="px-2.5 py-3 text-center">Edit</th>
          <th class="px-2.5 py-3 text-center">Delete</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-800 text-sm">
        {% for page in pages %}
        <tr class="hover:bg-slate-800/40 transition">
          <td class="px-3 py-4 font-medium text-slate-100 flex items-center gap-2">
            {{ page.title }}
            {% if page.is_published %}
            <a href="{% url 'page_detail' request.user.username page.slug %}" class="text-blue-400 hover:text-blue-300 transition">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-square-arrow-out-up-right-icon lucide-square-arrow-out-up-right"><path d="M21 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6"/><path d="m21 3-9 9"/><path d="M15 3h6v6"/></svg>
            </a>
            {% endif %}
          </td>
          <td class="px-3 py-4 text-slate-400 truncate max-w-[300px]">{{ page.content|truncatechars:30 }}</td>
          <td class="px-3 py-4 text-slate-400 ">{{ page.created_at }}</td>
          <td class="px-2.5 py-4 text-center">
            {% if page.is_published %}
              <span class="rounded-full bg-green-500/20 px-2 py-1 text-xs font-medium text-green-400">Yes</span>
            {% else %}
              <span class="rounded-full bg-red-500/20 px-2 py-1 text-xs font-medium text-red-400">No</span>
            {% endif %}
          </td>

          <!-- Edit Icon -->
          <td class="px-2.5 py-4 text-center">
            <a href="{% url 'edit_page' page.id %}" class="text-yellow-400 hover:text-yellow-300 transition cursor-pointer" title="Edit">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pencil-icon lucide-pencil"><path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"/><path d="m15 5 4 4"/></svg>
            </a>
          </td>

          <!-- Delete Icon -->
          <td class="px-2.5 py-4 text-center">
            <form method="post" action="{% url 'delete_page' page.id %}">
              {% csrf_token %}
              <button type="submit" class="cursor-pointer text-red-400 hover:text-red-300 transition" title="Delete"
                      onclick="return confirm('Are you sure you want to delete this page?');">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 mx-auto"> <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
              </button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="px-6 py-6 text-center text-slate-500">
            <img src="{% static 'no-pages.svg' %}" alt="No Pages" class="mx-auto h-70" />
            <p>No pages found.</p>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
